<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>IT‑Systembetreuung</title>
    <style>
        /* 1. Variablen & Basis-Setup */
        :root {
            --page-bg: #f2f4f7;
            --card-bg: #fff;
            --text: #1f2937;
            --muted: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 2px 8px rgba(17, 24, 39, .08);
            --radius: 12px;
            --gap: 16px;
            --input-bg: #f8fafc;
            --input-border: #e5e7eb;
            --input-hover: #f1f5f9;
            --focus: #3b82f6;
            --btn-bg: #2563eb;
            --btn-bg-hover: #1d4ed8;
            --btn-text: #fff;
        }

        html, body {
            margin: 0;
            background: var(--page-bg);
            color: var(--text);
            font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        .page {
            max-width: 920px;
            margin: 28px auto;
            padding: 0 16px;
        }

        /* 2. Header & Layout-Komponenten */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .title { font-size: 28px; font-weight: 700; }
        .user { color: var(--muted); font-size: 14px; }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 14px;
            margin-bottom: 16px;
        }

        .section-title { font-size: 18px; font-weight: 700; margin: 0 0 8px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
        .grid.full { grid-template-columns: 1fr; }

        /* 2.5 Info-Box */
        .info-box {
            background-color: #fef3c7; /* light orange/yellow */
            color: #b45309; /* dark orange/brown text */
            border: 1px solid #fbbf24; /* orange border */
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.5;
        }

        /* 3. Formular-Elemente */
        .label { display: block; font-weight: 600; margin-bottom: 6px; }

        select, input[type="text"], input[type="email"], textarea {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 10px;
            padding: 10px 12px;
            color: var(--text);
            box-sizing: border-box;
        }

        select:hover, input:hover, textarea:hover { background: var(--input-hover); }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, .15);
        }

        /* 4. Buttons */
        .actions { margin-top: 12px; }

        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: 1px solid transparent;
            border-radius: 10px;
            padding: 8px 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary:hover { background: var(--btn-bg-hover); }

        /* 5. Spezifische Modifikationen (wie gewünscht) */
        .list { display: grid; gap: 8px; }

        /* Benutzerverwaltung Zeile */
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr 1.2fr auto;
            gap: 24px;
            align-items: center;
        }

        .row .btn {
            padding: 6px 10px;
            font-size: 13px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #fff;
            cursor: pointer;
            white-space: nowrap;
        }

        /* Geräte-Bereich kompakt */
        #sec-device .grid { gap: 24px; }
        #sec-device input, #sec-device select { padding: 6px 10px; font-size: 13.5px; }
        #sec-device .label { font-size: 13.5px; margin-bottom: 4px; }

        /* Interaktive Akkordeons */
        details { padding: 0; }
        summary { list-style: none; cursor: pointer; }
        summary::-webkit-details-marker { display: none; }
        details > .grid, details > .list, details > .actions { margin-top: 8px; }

        /* 6. Responsive Anpassungen */
        @media (max-width: 820px) {
            .grid { grid-template-columns: 1fr; }
            .row { grid-template-columns: 1fr; gap: 12px; }
        }
    </style>
</head>
<body>

<div class="page">
    <header class="header">
        <div class="title">IT‑Systembetreuung</div>
        <div class="user">Christian Gebhard, Bildungsdirektion Kärnten</div>
    </header>

    <div class="info-box">
        Liebe Kolleg*innen.<br><br>
        Um eine effiziente Hilfe zu bewerkstelligen, sind wir auf gute und klare Kommunikation angewiesen. 
        An jedem Schulstandort befindet sich mindestens eine Person (Direktion, Kustodiat, Office oder eine andere ernannte Person), die in der Schule einen gewissen Überblick behält und die sich bei Problemen die Situation zuerst selbst ansieht, bevor eine Anforderung an die Betreuung gestellt wird.<br>
        Vielen Dank für die Wahrnehmung der Eigenverantwortung!
    </div>

    <section class="card" id="sec-schuldaten">
        <h2 class="section-title">1. Schuldaten</h2>
        <div class="grid">
            <div>
                <label class="label" for="school">Schule auswählen</label>
                <select id="school" name="school">
                    <option value="">Bitte wählen…</option>
                    <optgroup label="FE">
                        <option value="VS Radweg">VS Radweg</option>
                        <option value="MS‑Feldkirchen‑Digital">MS‑Feldkirchen‑Digital</option>
                        <option value="Musik‑MS‑Feldkirchen">Musik‑MS‑Feldkirchen</option>
                        <option value="VS Feldkirchen">VS Feldkirchen</option>
                        <option value="VS Glanegg">VS Glanegg</option>
                        <option value="VS St. Martin">VS St. Martin</option>
                        <option value="VS St. Ulrich">VS St. Ulrich</option>
                        <option value="VS Glanhofen">VS Glanhofen</option>
                        <option value="VS St. Urban">VS St. Urban</option>
                        <option value="VS Steuerberg">VS Steuerberg</option>
                        <option value="VS Himmelberg">VS Himmelberg</option>
                        <option value="PTS Feldkirchen">PTS Feldkirchen</option>
                        <option value="VS Steindorf">VS Steindorf</option>
                        <option value="VS Bodensdorf">VS Bodensdorf</option>
                        <option value="VS Ossiach">VS Ossiach</option>
                        <option value="VS Sirnitz">VS Sirnitz</option>
                    </optgroup>
                    <optgroup label="Villach">
                        <option value="ms-villach2">MS2 VI</option>
                        <option value="ms-villach3">MS3 VI</option>
                        <option value="PTS VI">PTS VI</option>
                        <option value="VS1 VI">VS1 VI</option>
                        <option value="VS2 VI">VS2 VI</option>
                        <option value="VS3 VI">VS3 VI</option>
                        <option value="VS4 VI">VS4 VI</option>
                        <option value="VS5 VI">VS5 VI</option>
                        <option value="VS6 VI">VS6 VI</option>
                        <option value="VS13 VI">VS13 VI</option>
                    </optgroup>
                    <optgroup label="Villach-Land">
                        <option value="VS Sattendorf">VS Sattendorf</option>
                        <option value="VS Bad Bleiberg">VS Bad Bleiberg</option>
                        <option value="MS Nötsch">MS Nötsch</option>
                    </optgroup>
                    <optgroup label="Klagenfurt-Land">
                        <option value="VS Tigring">VS Tigring</option>
                    </optgroup>
                    <optgroup label="St. Veit an der Glan">
                        <option value="VS Deutsch‑Griffen">VS Deutsch‑Griffen</option>
                    </optgroup>
                </select>
            </div>
            <div>
                <label class="label" for="emailFrom">Absender E‑Mail‑Adresse</label>
                <input disabled id="emailFrom" placeholder="Wird automatisch generiert…" type="text" />
            </div>
            <div>
                <label class="label" for="role">Funktion des Absenders</label>
                <select id="role">
                    <option selected>Bitte wählen…</option>
                    <option>Direktion</option>
                    <option>Kustode</option>
                    <option>Office</option>
                </select>
            </div>
        </div>
    </section>

    <section class="card" id="sec-problem">
        <details>
            <summary class="section-title">2. Problembeschreibung oder allgemeine Anfragen</summary>
            <div class="grid full">
                <label class="label" for="desc">Beschreibung</label>
                <textarea id="desc" placeholder="Bitte um klare Beschreibung des Anliegens!" rows="6"></textarea>
            </div>
        </details>
    </section>

    <section class="card" id="sec-users">
        <details>
            <summary class="section-title">3. Benutzerverwaltung (Lehrer*innen)</summary>
            <div class="list" id="userList"></div>
            <div class="actions">
                <button id="btnAdd" type="button">Konto hinzufügen/löschen/bearbeiten</button>
            </div>
        </details>
    </section>

    <section class="card" id="sec-device">
        <details>
            <summary class="section-title">4. Problem mit bestimmten Gerät</summary>
            <div class="grid">
                <div>
                    <label class="label" for="deviceType">Geräteart</label>
                    <select id="deviceType">
                        <option value="">Bitte wählen…</option>
                        <option>Computer</option>
                        <option>Drucker</option>
                        <option>Kopierer</option>
                        <option>SmartBoard</option>
                        <option>Anderes Gerät</option>
                    </select>
                </div>
                <div>
                    <label class="label" for="deviceName">Gerätename (siehe PC-Desktop rechts unten)</label>
                    <input id="deviceName" placeholder="z. B. SC-VW-01" type="text" />
                </div>
                <div>
                    <label class="label" for="deviceIP">IP‑Adresse (siehe PC-Desktop rechts unten)</label>
                    <input id="deviceIP" placeholder="z. B. 10.2.52.2" type="text" />
                </div>
                <div>
                    <label class="label" for="deviceLan">LAN‑Anschlussnummer</label>
                    <input id="deviceLan" placeholder="z. B. 12.19" type="text" />
                </div>
                <div>
                    <label class="label" for="deviceRoomNum">Raumnummer (siehe Türrahmen)</label>
                    <input id="deviceRoomNum" placeholder="z. B. 20/2" type="text" />
                </div>
                <div>
                    <label class="label" for="deviceRoom">Raum</label>
                    <select id="deviceRoom">
                        <option value="">Wählen…</option>
                        <option>Direktion</option>
                        <option>Office</option>
                        <option>Lehrerzimmer</option>
                        <option>Bibliothek</option>
                        <option>Klasse</option>
                        <option>EDV‑Raum</option>
                    </select>
                </div>
            </div>
        </details>
    </section>

    <section class="card" id="sec-internet">
        <details>
            <summary class="section-title">5. Internetverfügbarkeit</summary>
            <div class="grid">
                <div>
                    <label class="label" for="internetArea">Betroffener Bereich</label>
                    <select id="internetArea">
                        <option value="">Bitte wählen…</option>
                        <option>Gesamte Schule</option>
                        <option>Einzelnes Gerät</option>
                        <option>Einzelner Raum</option>
                    </select>
                </div>
                <div>
                    <label class="label" for="internetType">Art des Verbindungsausfalls</label>
                    <select id="internetType">
                        <option value="">Bitte wählen…</option>
                        <option>WLAN (Drahtlos)</option>
                        <option>LAN (Kabel)</option>
                        <option>Beides / Unklar</option>
                    </select>
                </div>
                <div>
                    <label class="label" for="internetError">Fehlerbild</label>
                    <select id="internetError">
                        <option value="">Bitte wählen…</option>
                        <option>Totalausfall (Keine Verbindung)</option>
                        <option>Verbindungsabbrüche / Instabil</option>
                        <option>Anmeldung nicht möglich</option>
                    </select>
                </div>
            </div>
        </details>
    </section>

    <section class="card">
        <div class="actions">
            <button class="btn-primary" type="button" id="btnSubmit">Anfrage absenden</button>
        </div>
    </section>
</div>

<script>
    /** KONFIGURATION **/
    const RECEIVER_EMAIL = 'christian.gebhard@kmz.ksn.at';

    const SCHOOL_SLUG_MAP = {
        'Musik‑MS‑Feldkirchen': 'musik-ms-feldkirchen',
        'MS‑Feldkirchen‑Digital': 'ms-feldkirchen-digital',
        'VS St. Martin': 'vs-st-martin',
        'MS Landskron': 'ms-landskron',
        'MS Nötsch': 'ms-noetsch',
        'MS Gegendtal': 'ms-gegendtal'
    };

    const SCHOOL_DOMAIN_MAP = {
        'VS Deutsch‑Griffen': 'vs-deutsch-griffen.ksn.at',
        'ms-villach2': 'ms-villach2.ksn.at',
        'ms-villach3': 'ms-villach3.ksn.at',
        'VS1 VI': 'vs-villach1.ksn.at',
        'VS2 VI': 'vs-villach2.ksn.at',
        'VS3 VI': 'vs-villach3.ksn.at',
        'VS4 VI': 'vs-villach4.ksn.at',
        'VS5 VI': 'vs-villach5.ksn.at',
        'VS6 VI': 'vs-villach6.ksn.at'
    };

    /** FUNKTIONEN **/

    // Konvertiert Schulnamen in URL-freundliche Slugs
    function toSlug(name) {
        const map = { 'ä': 'ae', 'ö': 'oe', 'ü': 'ue', 'Ä': 'ae', 'Ö': 'oe', 'Ü': 'ue', 'ß': 'ss' };
        return name.replace(/[äöüÄÖÜß]/g, ch => map[ch])
            .toLowerCase()
            .replace(/[\s\u202F\u00A0]+/g, '-')
            .replace(/[^a-z0-9\-]/g, '')
            .replace(/-+/g, '-')
            .replace(/^-|-$|^$/g, '');
    }

    // Generiert die E-Mail basierend auf Schule und Rolle
    function generateSenderEmail() {
        const schoolSel = document.getElementById('school');
        const roleSel = document.getElementById('role');
        const out = document.getElementById('emailFrom');
        
        const school = schoolSel && schoolSel.value !== '' ? schoolSel.value : '';
        const role = roleSel && roleSel.value !== 'Bitte wählen…' ? roleSel.value : '';

        if (!school || !role) {
            out.value = 'Wird automatisch generiert…';
            return;
        }

        const schoolSlug = SCHOOL_SLUG_MAP[school] || toSlug(school);
        const domain = SCHOOL_DOMAIN_MAP[school] || `${schoolSlug}.ksn.at`;
        const roleMap = { 'Direktion': 'direktion', 'Kustode': 'kustode', 'Office': 'office' };
        
        out.value = `${roleMap[role]}@${domain}`;
    }

    // Erzeugt eine neue Zeile für die Lehrerverwaltung
    function createUserRow(first = '', last = '') {
        const row = document.createElement('div');
        row.className = 'row';
        
        row.innerHTML = `
            <input type="text" placeholder="Vorname">
            <input type="text" placeholder="Nachname">
            <select>
                <option>Aktion wählen…</option>
                <option>Neuer Account</option>
                <option>Passwort zurücksetzen</option>
                <option>MFA‑Registrierung zurücksetzen</option>
                <option>Account löschen</option>
            </select>
            <button type="button" class="btn">Entfernen</button>
        `;

        row.querySelector('.btn').addEventListener('click', () => row.remove());
        return row;
    }

    // Hauptfunktion zum Sammeln und Versenden der Daten
    function collectAndSendEmail() {
        const school = document.getElementById('school').value;
        const senderEmail = document.getElementById('emailFrom').value;
        const problemDesc = document.getElementById('desc').value.trim();
        
        let bodyContent = `**IT-Support Anfrage**\n\n`;
        bodyContent += `1. Schuldaten:\n`;
        bodyContent += `   Schule: ${school || 'Nicht angegeben'}\n`;
        bodyContent += `   Absender-E-Mail: ${senderEmail || 'Nicht generierbar / Nicht angegeben'}\n\n`;

        // 2. Problembeschreibung
        if (problemDesc) {
            bodyContent += `2. Problembeschreibung / Allgemeine Anfrage:\n`;
            bodyContent += `${problemDesc}\n\n`;
        }
        
        // 3. Benutzerverwaltung
        const userRows = document.querySelectorAll('#userList .row');
        if (userRows.length > 0) {
            bodyContent += `3. Benutzerverwaltung (Lehrer*innen):\n`;
            userRows.forEach((row, index) => {
                const [firstName, lastName, action] = row.querySelectorAll('input, select');
                bodyContent += `   ${index + 1}. Person: ${firstName.value || 'N/A'} ${lastName.value || 'N/A'} - Aktion: ${action.value || 'N/A'}\n`;
            });
            bodyContent += `\n`;
        }

        // 4. Problem mit Gerät
        const deviceType = document.getElementById('deviceType').value;
        if (deviceType) {
            bodyContent += `4. Problem mit bestimmtem Gerät:\n`;
            bodyContent += `   Geräteart: ${deviceType}\n`;
            bodyContent += `   Gerätename: ${document.getElementById('deviceName').value || 'N/A'}\n`;
            bodyContent += `   IP-Adresse: ${document.getElementById('deviceIP').value || 'N/A'}\n`;
            bodyContent += `   LAN-Anschluss: ${document.getElementById('deviceLan').value || 'N/A'}\n`;
            bodyContent += `   Raumnummer: ${document.getElementById('deviceRoomNum').value || 'N/A'}\n`;
            bodyContent += `   Raum: ${document.getElementById('deviceRoom').value || 'N/A'}\n\n`;
        }

        // 5. Internetverfügbarkeit
        const internetArea = document.getElementById('internetArea').value;
        if (internetArea) {
            bodyContent += `5. Internetverfügbarkeit:\n`;
            bodyContent += `   Betroffener Bereich: ${internetArea}\n`;
            bodyContent += `   Art des Ausfalls: ${document.getElementById('internetType').value || 'N/A'}\n`;
            bodyContent += `   Fehlerbild: ${document.getElementById('internetError').value || 'N/A'}\n\n`;
        }

        // Betreff festlegen
        const subject = school ? `IT-Anfrage: ${school} (${document.getElementById('role').value})` : 'IT-Anfrage (Schule nicht ausgewählt)';

        // Mailto-Link erstellen und öffnen
        const mailtoLink = `mailto:${RECEIVER_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyContent)}`;
        window.location.href = mailtoLink;
    }

    /** EVENT LISTENER **/
    document.addEventListener('DOMContentLoaded', () => {
        // E-Mail-Generierung bei Auswahl
        ['school', 'role'].forEach(id => {
            document.getElementById(id).addEventListener('change', generateSenderEmail);
        });
        generateSenderEmail(); // Initialer Aufruf

        // Benutzerverwaltung hinzufügen
        const userList = document.getElementById('userList');
        const btnAdd = document.getElementById('btnAdd');
        btnAdd.addEventListener('click', () => userList.appendChild(createUserRow()));

        // Absenden-Button verknüpfen
        document.getElementById('btnSubmit').addEventListener('click', collectAndSendEmail);
    });
</script>

</body>
</html>